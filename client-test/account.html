<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    
    <p class="box"></p>
    
    <script>
        function logout(){  
            document.cookie = 'token=;';
            location.replace("http://127.0.0.1:5500/templatePBL5/login.html")
        }
        var box = document.querySelector('.box')
        
        function getJwtFromCookie() {                    //lấy token được lưu trong cookie ra
            const name = 'token='
            const decodedCookie = decodeURIComponent(document.cookie)
            const cookieArray = decodedCookie.split(';')
            for (let i = 0; i < cookieArray.length; i++) {
                let cookie = cookieArray[i]
                while (cookie.charAt(0) == ' ') {
                cookie = cookie.substring(1)
                }
                if (cookie.indexOf(name) == 0) {
                return cookie.substring(name.length, cookie.length)
                }
            }
            return ''
        }

        fetch('http://localhost:3000/user/profile', {
        method: 'GET',
        headers: {
            'Authorization': `Bearer ${getJwtFromCookie()}`                     // trả token về server để xử lí
        }
        })
        .then(response => response.json())
        .then(data => {
            
            console.log(data)
            let html = ''
            if (data.success !== false) {                           
                html = `<H1>xin chào ${data.user.LastName} với vai trò ${data.role} `
                    html+='<button onclick="logout()">log out</button>'       
                box.innerHTML = html
            }
            else {
                html=`<a href="main.html">${data.message}</a>`
                box.style.color = 'red'
                box.innerHTML = html
            }
            
        })

         

        
    </script>
</body>
</html>
